# Agent Customization — Architect Agent (bmad-ignition)
# Ignition/IA domain knowledge for UDT design and ISA-95 architecture
# See: _bmad-output/planning-artifacts/architecture.md#Memory Formatting

# Add custom critical actions (appended after standard config loading)
critical_actions:
  # Safety Awareness Actions
  - "Flag SIS (Safety Instrumented System) configurations in architecture documents — note when designs touch safety-related equipment, interlocks, or functions that require engineering authority review"
  - "Document engineering authority requirements for any safety-critical architecture decisions — SIL-rated systems, alarm priority assignments affecting safety, and interlock modifications require qualified engineer sign-off"

  # IT/OT Boundary Actions
  - "Identify IT/OT network boundaries explicitly in architecture — document which components exist in the OT zone, which in the DMZ, and which connections cross security boundaries per IEC 62443"

  # UDT Hierarchy Validation Actions
  - "Validate UDT hierarchy designs against ISA-95 equipment model before finalizing architecture — confirm Equipment Modules map to UDT definitions and inheritance reflects physical equipment relationships"

  # Master Data Model Actions
  - "Design database-driven tag instantiation as the default architecture pattern — the ISA-95 equipment hierarchy should be modeled in SQL tables first, then UDT instances created from database queries. This enables scalable deployment, cross-system consistency, and proper data governance."

# Add persistent memories for the agent
memories:
  # ISA-95 Equipment Hierarchy (4 memories)
  - "Design architecture using ISA-95 six-level equipment hierarchy: Enterprise → Site → Area → Line → Cell → Equipment Module. Map each level to Ignition folder structure: `[default]Site/Area/Line/Cell/Equipment/Tag` for consistent tag organization."

  - "Map ISA-95 hierarchy to Ignition tag folders: Site = top-level folder, Area = major plant section, Line = production line or process unit, Cell = machine group or work center, Equipment Module = individual equipment with its UDT instance. This enables area-based alarm filtering and hierarchical navigation."

  - "Design alarm and reporting architecture around ISA-95 hierarchy: configure alarm pipelines to filter by Area or Line, design production reports to aggregate by hierarchy level, enable drill-down navigation from Site overview to Equipment Module detail screens."

  - "Design enterprise-to-asset navigation following ISA-95 hierarchy: Site overview screens show Area status, Area screens show Line health, Line screens show Cell operations, Cell screens provide Equipment Module detail. Each navigation level reflects the physical plant organization."

  # UDT Structure Best Practices (4 memories)
  - "Use PascalCase for UDT definition names (`Tank`, `Motor`, `Compressor`, `ConveyorSection`) and descriptive names for instances reflecting physical equipment (`coolingTank1`, `mainFeedPump`, `pasteurizerAgitator`). This distinguishes definitions from instances in the tag browser."

  - "Design UDT inheritance hierarchies for equipment families: create a base `EquipmentModule` UDT with common properties (status, alarm enable, maintenance mode), then extend it for specific equipment types. Use `extends` property to inherit tags, parameters, and alarm configurations."

  - "Define UDT parameters for dynamic binding: create parameters for `BasePath`, `EquipmentName`, `PLCPath`, `HistorianEnabled` at the definition level. Instance creators bind these parameters to specific values, enabling one UDT definition to serve many equipment instances."

  - "Choose UDT composition vs inheritance based on equipment relationships: use inheritance (extends) when equipment types share common behavior (all motors have run/stop status), use composition (nested UDTs) when equipment contains sub-components (a skid contains multiple motors and valves)."

  # Tag Path Structure (4 memories)
  - "Design tag path format using provider syntax: `[provider]Path/To/Tag`. The default provider is `[default]`. Specify OPC paths using `[OPC-UA]ns=1;s=[Device]Path/Tag` format. Document the provider strategy in architecture for project consistency."

  - "Organize tag folders following ISA-95 alignment: `[default]Site/Area/Line/Cell/Equipment/`. Each Equipment folder contains UDT instances for that equipment. This structure supports hierarchical alarm filtering, area-based production reports, and intuitive tag browser navigation."

  - "Design UDT parameter binding patterns for tag paths: use `{BasePath}/{EquipmentName}/Tag` pattern in UDT definitions. Parameters resolve at instance creation, enabling portable UDT definitions. Document parameter naming conventions in architecture."

  - "Specify tag path verification requirements in architecture: before creating Perspective bindings or Jython scripts, verify tag paths exist in the Gateway. Document which tags must exist before each development phase. Unverified paths cause runtime errors difficult to debug in production."

  # Database-Driven Master Data Model (6 memories)
  - "Design a centralized SQL database as the **single source of truth** for the equipment model. Abstract the ISA-95 hierarchy into database tables rather than embedding it only in Ignition tags. This master data model can be consumed by ERP (Level 4), MES (Level 3), and SCADA (Level 2) systems, enabling cross-system consistency and data governance."

  - "Design the master data schema with these core tables: `Equipment` (plant hierarchy instances with Enterprise/Site/Area/Line/Cell/Equipment columns and Parent ID for hierarchy), `EquipmentType` (equipment classes mapping to UDT definition names), `DataType` (UDT metadata), `DataTypeProperties` (tags and parameters within each UDT). This schema drives tag instantiation."

  - "Model equipment properties as both static attributes (capacity, material, manufacturer) and dynamic data (setpoints, actual values, PLC addresses). Store static properties in database columns; dynamic properties link to UDT tags. This separation enables database-driven configuration while tags handle real-time data."

  - "Use database queries to drive UDT instantiation: write Jython scripts or Gateway Event scripts that query the Equipment table, retrieve equipment type and properties, then create or update UDT instances with parameters populated from database values. This enables **scalable deployment** — add equipment by inserting rows, run script to create tags."

  - "Design named queries for equipment navigation: `getEquipmentByArea`, `getEquipmentByType`, `getEquipmentHierarchy`. Perspective views bind to these queries for dynamic equipment lists, drill-down navigation, and maintenance tracking. The database becomes the source for both tag structure AND HMI navigation."

  - "Document the master data governance process in architecture: define who owns equipment records, how changes are versioned, and how updates propagate to Ignition tags. This is critical for multi-site deployments, acquisitions, and enterprise-wide consistency."

  # Database Schema Patterns (3 memories)
  - "Design equipment metadata tables with ISA-95 alignment: include `equipment_id`, `equipment_name`, `equipment_type`, `parent_path`, `isa95_level`, `area`, `line`, `cell`. This enables database-driven navigation, equipment lists, and maintenance tracking that mirrors the tag hierarchy."

  - "Design historian configuration in architecture: document which tags log to historian, at what resolution, and retention duration. Use tag path patterns for historian binding: `[default]*/Status`, `[default]*/ProcessValue` to automatically include conforming UDT instances."

  - "Model equipment-to-database relationships: equipment metadata in SQL tables links to Ignition tags via `equipment_id` parameter in UDTs. Named queries retrieve equipment lists by area, maintenance schedules by line, and production data by hierarchy level."

  # ISA-88 Batch Control (4 memories)
  - "For batch process projects (food & beverage, pharmaceuticals, chemicals), apply ISA-88 procedural model in architecture: Recipe defines the product, containing Procedures (make product) > Unit Procedures (operate a unit) > Operations (major processing action) > Phases (discrete step like fill, heat, mix)."

  - "Map ISA-88 equipment model to UDT hierarchy: Process Cell contains Units (equipment groups that execute unit procedures), Units contain Equipment Modules (physical equipment like tanks, vessels), Equipment Modules contain Control Modules (valves, motors, sensors). Design UDT inheritance to reflect this hierarchy."

  - "Design phase state machine architecture per ISA-88: phases transition through Idle > Running > Complete states with exception states (Pausing, Paused, Holding, Held, Stopping, Stopped, Aborting, Aborted). Include state tracking tags in phase UDT definitions and document state transition logic."

  - "Document ISA-88 applicability in architecture: batch control patterns apply to industries with discrete production runs (food & beverage, pharmaceuticals, specialty chemicals, cosmetics). Continuous processes (oil refinery, power plant, water treatment) use steady-state monitoring patterns instead."

# Add custom menu items (appended to base menu)
# Don't include * prefix or help/exit - auto-injected
menu: []
# Example:
# menu:
#   - trigger: my-workflow
#     workflow: "{project-root}/custom/my.yaml"
#     description: My custom workflow

# Add custom prompts (for action="#id" handlers)
prompts: []
# Example:
# prompts:
# - id: my-prompt
#   content: |
#     Prompt instructions here
