# Agent Customization — SM Agent (bmad-ignition)
# Parallel execution coordination and file isolation knowledge for Ignition projects
# See: _bmad-output/planning-artifacts/architecture.md#Memory Formatting

# Add custom critical actions (appended after standard config loading)
critical_actions:
  # File Overlap Prevention
  - "Verify no file overlap before assigning parallel stories — compare File List sections of all in-progress stories to detect conflicts"

  # File Ownership Documentation
  - "Document file ownership in story assignments — list specific view folders, UDT files, script modules, and tag hierarchy branches each story will modify"

  # Merge Conflict Check
  - "Check for potential merge conflicts before marking stories ready-for-dev — ensure no two concurrent stories touch the same JSON files, UDT definitions, or script modules"

  # Feature Branch Enforcement
  - "Require feature branches for parallel work — each in-progress story must have its own branch named after the story key to enable clean merges"

# Add persistent memories for the agent
memories:
  # File Isolation Rules — Perspective Views
  - "Assign one agent per Perspective view folder. Each view is a single `view.json` file in `com.inductiveautomation.perspective/views/<ViewName>/`. Two agents editing the same view causes unresolvable JSON merge conflicts."

  # File Isolation Rules — UDT Definitions
  - "Assign one agent per UDT definition file. UDT definitions are stored as individual JSON files in the `UDTs/` folder (e.g., `Tank.json`, `Motor.json`). Concurrent UDT edits break inheritance chains and dependent instances."

  # File Isolation Rules — Scripts
  - "Assign one agent per script file. Jython library scripts in `ignition/script-python/project/` are single files per module. Concurrent edits cause line-level merge conflicts that require manual resolution."

  # File Isolation Rules — Tag Folders
  - "Assign one agent per ISA-95 hierarchy branch in tag folders. Tag paths follow `[provider]Site/Area/Line/Cell/Equipment` structure. Assigning Agent A to `Area1/Line1/` and Agent B to `Area1/Line2/` prevents overlap while allowing parallel work."

  # Story Naming Conventions
  - "Story files follow the naming pattern `{epic_num}-{story_num}-{slug}.md` (e.g., `3-2-populate-sm-agent.md`). This convention ensures unique story identifiers and enables automated status tracking in sprint-status.yaml."

  # Story Artifact Isolation
  - "Each story must produce distinct output files that don't overlap with other active stories. When creating stories, verify the File List sections don't reference the same files across concurrent work."

  # Branch Naming for Parallel Work
  - "Use feature branch naming `{story_key}` or `{epic}-{story}-{slug}` for parallel development branches (e.g., `3-2-populate-sm-agent`). Merge to main after story completion and code review to avoid long-lived branch conflicts."

  # Merge Strategy — JSON Files (Perspective Views)
  - "JSON files (Perspective `view.json`, UDT definitions) are merge-hostile. Git cannot three-way merge JSON meaningfully — concurrent changes typically require one version to win completely. Prevent conflicts by never assigning the same JSON file to multiple parallel stories."

  # Merge Strategy — XML Files (Tags)
  - "Tag export XML files have hierarchical structure where whitespace and ordering matter. Concurrent tag edits in overlapping hierarchy branches cause difficult merge conflicts. Assign tag work by ISA-95 hierarchy branch to avoid overlap."

  # Merge Strategy — Scripts (Jython)
  - "Jython script files support line-level Git merges but shared utility functions cause conflicts. When parallel stories need shared script functionality, create the shared function in one story first, merge, then reference it in dependent stories."

  # Git Workflow for Parallel Development
  - "For parallel Ignition development: create feature branches from main, assign non-overlapping file ownership, merge completed stories promptly, and rebase long-running branches regularly to reduce merge distance."

  # Ignition Project Structure — Perspective
  - "Perspective projects store views in `com.inductiveautomation.perspective/views/` with one folder per view containing `view.json`. Resources, styles, and page configs are in sibling folders. Assign entire view folders as atomic units."

  # Ignition Project Structure — Tags
  - "Tags are organized in provider folders following ISA-95 hierarchy: `tags/default/Site/Area/Line/Cell/Equipment/`. UDT definitions live in the `UDTs/` folder. Tag instances reference UDTs via `typeId`. Organize parallel work along hierarchy boundaries."

  # Ignition Project Structure — Scripts
  - "Jython scripts are in `ignition/script-python/` with `project/` for project-scoped library scripts and gateway-scoped event handlers. Each `.py` file is a module. Shared utility scripts are high-contention files — assign carefully."

  # Ignition Project Structure — Named Queries
  - "Named queries are stored in `com.inductiveautomation.perspective/queries/` (or project-specific query folders). Each query is a folder with config files. Assign query folders to agents the same way as views — one folder per agent."

# Add custom menu items (appended to base menu)
# Don't include * prefix or help/exit - auto-injected
menu: []

# Add custom prompts (for action="#id" handlers)
prompts: []
